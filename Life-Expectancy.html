<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />


<meta name="author" content="Steven Mann" />


<title>Global Life Expectancy Prediction Using Random Forest</title>

<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/bootstrap.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/highlightjs-9.12.0/default.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>



<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>




<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 51px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h2 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h3 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h4 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h5 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h6 {
  padding-top: 56px;
  margin-top: -56px;
}
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #ffffff;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  background: white;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->




</head>

<body>


<div class="container-fluid main-container">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">Steve Mann Portfolio</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">Home</a>
</li>
<li>
  <a href="AttritionProject.html">Attrition (knn Classification &amp; MLR)</a>
</li>
<li>
  <a href="BeerProject.html">Beer (knn Classification &amp; Data Vis</a>
</li>
<li>
  <a href="BankDeposits.html">Bank Deposits (Logistic Regression)</a>
</li>
<li>
  <a href="Life-Expectancy.html">Life Expectancy (Random Forest)</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div class="fluid-row" id="header">



<h1 class="title toc-ignore">Global Life Expectancy Prediction Using Random Forest</h1>
<h4 class="author">Steven Mann</h4>
<h4 class="date">9/28/2020</h4>

</div>


<pre class="r"><code>#Life Expectancy Data from Kaggle
Life = read.csv(file.choose(),header = TRUE)</code></pre>
<pre class="r"><code>library(Amelia)</code></pre>
<pre><code>## Warning: package &#39;Amelia&#39; was built under R version 4.0.2</code></pre>
<pre><code>## Loading required package: Rcpp</code></pre>
<pre><code>## ## 
## ## Amelia II: Multiple Imputation
## ## (Version 1.7.6, built: 2019-11-24)
## ## Copyright (C) 2005-2021 James Honaker, Gary King and Matthew Blackwell
## ## Refer to http://gking.harvard.edu/amelia/ for more information
## ##</code></pre>
<pre class="r"><code>library(tidyverse)</code></pre>
<pre><code>## Warning: package &#39;tidyverse&#39; was built under R version 4.0.2</code></pre>
<pre><code>## -- Attaching packages ---------------------------------------------------------------------------- tidyverse 1.3.0 --</code></pre>
<pre><code>## v ggplot2 3.3.0     v purrr   0.3.4
## v tibble  3.0.1     v dplyr   0.8.5
## v tidyr   1.0.3     v stringr 1.4.0
## v readr   1.3.1     v forcats 0.5.0</code></pre>
<pre><code>## -- Conflicts ------------------------------------------------------------------------------- tidyverse_conflicts() --
## x dplyr::filter() masks stats::filter()
## x dplyr::lag()    masks stats::lag()</code></pre>
<pre class="r"><code>library(DataCombine)</code></pre>
<pre><code>## Warning: package &#39;DataCombine&#39; was built under R version 4.0.2</code></pre>
<pre class="r"><code>missmap(Life)</code></pre>
<p><img src="Life-Expectancy_files/figure-html/See%20what%20data%20is%20missing-1.png" width="672" /></p>
<p>#We see Population is biggest missing value. See if we can find that data on UN website. #Population Data downloaded from the UN #URL <a href="https://population.un.org/wpp/Download/Standard/Population/" class="uri">https://population.un.org/wpp/Download/Standard/Population/</a></p>
<pre class="r"><code>UNPOP = read.csv(file.choose(),header=TRUE)</code></pre>
<pre class="r"><code>#filter UN data set down to size
#Grab only columns of interest
UNPOP2 = data.frame(Country = UNPOP$Location,Year = UNPOP$Time,Population = UNPOP$PopTotal*1000)
#Filter to only time frame of interest
UNPOPclean = UNPOP2 %&gt;% filter(Year &gt;= 2000 &amp; Year &lt;= 2015)</code></pre>
<p>#Initially planned to replace only N/A values from original dataset. However, an inspection of the dataset #reveals that many population factors clearly aren’t correct. An inspection of just the first 2 countries #in the list, Afghanistan and Albania, reveal that year-over-year popluation fluctuations are by multiples or #divisions of 10x or 100x. Decided instead to replace the entire population data with data obtained from the #UN population database.</p>
<pre class="r"><code>#No Missing Values
missmap(UNPOPclean)</code></pre>
<p><img src="Life-Expectancy_files/figure-html/Check%20if%20any%20missing%20values%20in%20the%20UN%20Data-1.png" width="672" /></p>
<p>#Some country names do not match our other data set. This will mess with the merge. #Rename countries to fit with our dataset Using FindReplace function</p>
<pre class="r"><code>#Create Data frame to replace country names
Replace = data.frame(from = c(&quot;Dem. People&#39;s Republic of Korea&quot;,&quot;Micronesia \\(Fed. States of\\)&quot;,
                              &quot;Eswatini&quot;,&quot;North Macedonia&quot;,&quot;United Kingdom&quot;), 
                     to = c(&quot;Democratic People&#39;s Republic of Korea&quot;,&quot;Micronesia \\(Federated States of\\)&quot;,
                            &quot;Swaziland&quot;,&quot;The former Yugoslav republic of Macedonia&quot;,
                            &quot;United Kingdom of Great Britain and Northern Ireland&quot;))

#Replace Country Names
UNPOPclean2 = FindReplace(data = UNPOPclean,Var = &quot;Country&quot;,replaceData = Replace,
                          from = &quot;from&quot;,to = &quot;to&quot;,exact = FALSE)

#Merge Clean Population Data into our dataset
Lifeclean = left_join(Life, UNPOPclean2, by = c(&quot;Country&quot;, &quot;Year&quot;))

#Delete old Population Column
Lifeclean2 = Lifeclean[,-19]

#Rename Column
Lifeclean3 = Lifeclean2 %&gt;% rename(&quot;Population&quot; = Population.y)

#Filter out N/A Life Expectancies
Lifeclean3 = Lifeclean3 %&gt;% filter(is.na(Life.expectancy) == &quot;FALSE&quot;)

#Sanity Check - All good!
missmap(Lifeclean3)</code></pre>
<p><img src="Life-Expectancy_files/figure-html/Merging%20in%20Complete%20Population%20Data-1.png" width="672" /></p>
<pre class="r"><code>##Same issues with GDP 
##Get data from UN
## URL http://data.un.org/Data.aspx?d=SNAAMA&amp;f=grID%3a101%3bcurrID%3aUSD%3bpcFlag%3a0%3bitID%3a9
##filtered on the front-end to only include 2000 - 2015

GDP = read.csv(file.choose(),header = TRUE)

#Rename Columns
GDP2 = data.frame(Country = GDP$Country.or.Area,Year = GDP$Year,GDP = GDP$Value)

#Some country names do not match our other data set. This will mess with the merge.
#Rename countries to fit with our dataset Using FindReplace function

#Create Data frame to replace country names
Replace2 = data.frame(from = c(&quot;China, People&#39;s Republic of&quot;,
                               &quot;Iran, Islamic Republic of&quot;,&quot;Kingdom of Eswatini&quot;,
                               &quot;Republic of North Macedonia&quot;,&quot;United States&quot;,
                               &quot;United Republic of Tanzania: Mainland&quot;,&quot;Former Sudan&quot;), 
                      to = c(&quot;China&quot;,&quot;Iran \\(Islamic Republic of\\)&quot;,&quot;Swaziland&quot;,
                             &quot;The former Yugoslav republic of Macedonia&quot;,&quot;United States of America&quot;,&quot;United Republic of Tanzania&quot;,&quot;Sudan&quot;))

#Replace Country Names
GDP3 = FindReplace(data = GDP2,Var = &quot;Country&quot;,replaceData = Replace2,
                   from = &quot;from&quot;,to = &quot;to&quot;,exact = FALSE)

#Join Dataset with new GDP data
Lifeclean4 = left_join(Lifeclean3, GDP3, by = c(&quot;Country&quot;, &quot;Year&quot;))

#Delete old GDP Column
Lifeclean5 = Lifeclean4[,-18]

#Rename Column
Lifeclean6 = Lifeclean5 %&gt;% rename(&quot;GDP&quot; = GDP.y)

#Remaining N/A&#39;s are Niue, &amp; South Sudan. South Sudan didn&#39;t exist prior to 2008. Niue only has 1 year of data in original dataset. Reasonable.
Lifeclean6 %&gt;% filter(is.na(GDP)==TRUE)</code></pre>
<pre><code>##   Continent     Country Year     Status Life.expectancy Adult.Mortality
## 1    Africa South Sudan 2007 Developing            53.1             381
## 2    Africa South Sudan 2006 Developing            52.5             383
## 3    Africa South Sudan 2005 Developing            51.9             383
## 4    Africa South Sudan 2004 Developing            51.4             383
## 5    Africa South Sudan 2003 Developing            58.0             383
## 6    Africa South Sudan 2002 Developing            52.0             382
## 7    Africa South Sudan 2001 Developing            49.6             381
## 8    Africa South Sudan 2000 Developing            48.9              38
##   infant.deaths Alcohol percentage.expenditure Hepatitis.B Measles BMI
## 1            27      NA                      0          NA       0  NA
## 2            28      NA                      0          NA       0  NA
## 3            28      NA                      0          NA       0  NA
## 4            29      NA                      0          NA       0  NA
## 5            29      NA                      0          NA       0  NA
## 6            30      NA                      0          NA       0  NA
## 7            30      NA                      0          NA       0  NA
## 8            31      NA                      0          NA       0  NA
##   under.five.deaths Polio Total.expenditure Diphtheria HIV.AIDS
## 1                43    NA                NA         NA      4.2
## 2                43    NA                NA         NA      4.1
## 3                44    NA                NA         NA      3.9
## 4                45    NA                NA         NA      3.8
## 5                46    NA                NA         NA      3.5
## 6                48    NA                NA         NA      3.3
## 7                49    NA                NA         NA      3.0
## 8                50    NA                NA         NA      2.7
##   thinness..1.19.years thinness.5.9.years Income.composition.of.resources
## 1                   NA                 NA                               0
## 2                   NA                 NA                               0
## 3                   NA                 NA                               0
## 4                   NA                 NA                               0
## 5                   NA                 NA                               0
## 6                   NA                 NA                               0
## 7                   NA                 NA                               0
## 8                   NA                 NA                               0
##   Schooling Population GDP
## 1         0    8315144  NA
## 2         0    7907407  NA
## 3         0    7535931  NA
## 4         0    7213354  NA
## 5         0    6935665  NA
## 6         0    6688225  NA
## 7         0    6447791  NA
## 8         0    6199396  NA</code></pre>
<pre class="r"><code>#Sanity checks
summary(Lifeclean6$Population)</code></pre>
<pre><code>##      Min.   1st Qu.    Median      Mean   3rd Qu.      Max. 
## 7.601e+04 2.270e+06 8.349e+06 3.667e+07 2.474e+07 1.407e+09</code></pre>
<pre class="r"><code>summary(Lifeclean6$GDP)</code></pre>
<pre><code>##      Min.   1st Qu.    Median      Mean   3rd Qu.      Max.      NA&#39;s 
## 6.524e+07 5.280e+09 1.988e+10 3.083e+11 1.337e+11 1.822e+13         8</code></pre>
<pre class="r"><code>#See what else is missing
missmap(Lifeclean6)</code></pre>
<p><img src="Life-Expectancy_files/figure-html/Impute%20other%20missing%20values-1.png" width="672" /></p>
<pre class="r"><code>##Compute Median Hepatitis B by Country
HepBCountry = Lifeclean6 %&gt;% 
  filter(is.na(Hepatitis.B) == &quot;FALSE&quot;) %&gt;% 
  group_by(Country) %&gt;% 
  summarize(MedianHBCountry = median(Hepatitis.B))

##Compute Median Hepatitis B by Continent
HepBContinent = Lifeclean6 %&gt;% 
  filter(is.na(Hepatitis.B) == &quot;FALSE&quot;) %&gt;%
  group_by(Continent) %&gt;%
  summarize(MedianHBContinent = median(Hepatitis.B))

#Merge Medians by Continent
Lifeclean7 &lt;- merge(x = Lifeclean6,y = HepBContinent,by = &quot;Continent&quot;,all.x = TRUE)

#Merge Medians by Country
Lifeclean8 &lt;- merge(x = Lifeclean7,y = HepBCountry,by = &quot;Country&quot;,all.x = TRUE)

#If statement to cascade which median to use: Non-N/A Value &gt; Country Median
Lifeclean9 = within(Lifeclean8, 
       HepB1 &lt;- 
         ifelse(is.na(Hepatitis.B)==&quot;TRUE&quot;,
                MedianHBCountry,
              Hepatitis.B))

#If statement to cascade which median to use: Non-N/A value &gt; Country Median &gt; Continent Median
## Could be more efficient, but couldn&#39;t get nested ifelse to work
Lifeclean10 = within(Lifeclean9, 
                    HepBFinal &lt;- 
                      ifelse(is.na(HepB1)==&quot;TRUE&quot;,
                             MedianHBContinent,
                             HepB1))

#Drop Unneeded Columns
Lifeclean11 = select(Lifeclean10,-c(Hepatitis.B,MedianHBContinent,MedianHBCountry,HepB1))

##SanityCheck
missmap(Lifeclean11)</code></pre>
<p><img src="Life-Expectancy_files/figure-html/Impute%20other%20missing%20values-2.png" width="672" /></p>
<pre class="r"><code>##Compute Median by Country
ExpCountry = Lifeclean11 %&gt;% 
  filter(is.na(Total.expenditure) == &quot;FALSE&quot;) %&gt;% 
  group_by(Country) %&gt;% 
  summarize(MedianexpCountry = median(Total.expenditure))

##Compute Median by Continent
ExpContinent = Lifeclean11 %&gt;% 
  filter(is.na(Total.expenditure) == &quot;FALSE&quot;) %&gt;%
  group_by(Continent) %&gt;%
  summarize(MedianexpContinent = median(Total.expenditure))

#Merge Medians by Continent
Lifeclean12 &lt;- merge(x = Lifeclean11,y = ExpContinent,by = &quot;Continent&quot;,all.x = TRUE)

#Merge Medians by Country
Lifeclean13 &lt;- merge(x = Lifeclean12,y = ExpCountry,by = &quot;Country&quot;,all.x = TRUE)

#If statement to cascade which median to use: Non-N/A Value &gt; Country Median
Lifeclean14 = within(Lifeclean13, 
                    Exp1 &lt;- 
                      ifelse(is.na(Total.expenditure)==&quot;TRUE&quot;,
                             MedianexpCountry,
                             Total.expenditure))

#If statement to cascade which median to use: Non-N/A value &gt; Country Median &gt; Continent Median
## Could be more efficient, but couldn&#39;t get nested ifelse to work
Lifeclean15 = within(Lifeclean14, 
                     Total.expenditureFinal &lt;- 
                       ifelse(is.na(Exp1)==&quot;TRUE&quot;,
                              MedianexpContinent,
                              Exp1))

#Drop Unneeded Columns
Lifeclean16 = select(Lifeclean15,-c(Total.expenditure,MedianexpContinent,MedianexpCountry,Exp1))

##SanityCheck
missmap(Lifeclean16)</code></pre>
<p><img src="Life-Expectancy_files/figure-html/Impute%20other%20missing%20values-3.png" width="672" /></p>
<pre class="r"><code>##Compute Median by Country
AlcCountry = Lifeclean16 %&gt;% 
  filter(is.na(Alcohol) == &quot;FALSE&quot;) %&gt;% 
  group_by(Country) %&gt;% 
  summarize(MedianAlcCountry = median(Alcohol))

##Compute Median by Continent
AlcContinent = Lifeclean16 %&gt;% 
  filter(is.na(Alcohol) == &quot;FALSE&quot;) %&gt;%
  group_by(Continent) %&gt;%
  summarize(MedianAlcContinent = median(Alcohol))

#Merge Medians by Continent
Lifeclean17 &lt;- merge(x = Lifeclean16,y = AlcContinent,by = &quot;Continent&quot;,all.x = TRUE)

#Merge Medians by Country
Lifeclean18 &lt;- merge(x = Lifeclean17,y = AlcCountry,by = &quot;Country&quot;,all.x = TRUE)

#If statement to cascade which median to use: Non-N/A Value &gt; Country Median
Lifeclean19 = within(Lifeclean18, 
                     Alc1 &lt;- 
                       ifelse(is.na(Alcohol)==&quot;TRUE&quot;,
                              MedianAlcCountry,
                              Alcohol))

#If statement to cascade which median to use: Non-N/A value &gt; Country Median &gt; Continent Median
## Could be more efficient, but couldn&#39;t get nested ifelse to work
Lifeclean20 = within(Lifeclean19, 
                     AlcoholFinal &lt;- 
                       ifelse(is.na(Alc1)==&quot;TRUE&quot;,
                              MedianAlcContinent,
                              Alc1))

#Drop Unneeded Columns
Lifeclean21 = select(Lifeclean20,-c(Alcohol,MedianAlcContinent,MedianAlcCountry,Alc1))

##SanityCheck
missmap(Lifeclean21)</code></pre>
<p><img src="Life-Expectancy_files/figure-html/Impute%20other%20missing%20values-4.png" width="672" /></p>
<pre class="r"><code>##Compute Median by Country
IncCountry = Lifeclean21 %&gt;% 
  filter(is.na(Income.composition.of.resources) == &quot;FALSE&quot;) %&gt;% 
  group_by(Country) %&gt;% 
  summarize(MedianIncCountry = median(Income.composition.of.resources))

##Compute Median by Continent
IncContinent = Lifeclean21 %&gt;% 
  filter(is.na(Income.composition.of.resources) == &quot;FALSE&quot;) %&gt;% 
  group_by(Continent) %&gt;% 
  summarize(MedianIncContinent = median(Income.composition.of.resources))

#Merge Medians by Continent
Lifeclean22 &lt;- merge(x = Lifeclean21,y = IncContinent,by = &quot;Continent&quot;,all.x = TRUE)

#Merge Medians by Country
Lifeclean23 &lt;- merge(x = Lifeclean22,y = IncCountry,by = &quot;Country&quot;,all.x = TRUE)

#If statement to cascade which median to use: Non-N/A Value &gt; Country Median
Lifeclean24 = within(Lifeclean23, 
                     Inc1 &lt;- 
                       ifelse(is.na(Income.composition.of.resources)==&quot;TRUE&quot;,
                              MedianIncCountry,
                              Income.composition.of.resources))

#If statement to cascade which median to use: Non-N/A value &gt; Country Median &gt; Continent Median
## Could be more efficient, but couldn&#39;t get nested ifelse to work
Lifeclean25 = within(Lifeclean24, 
                     IncomeFinal &lt;- 
                       ifelse(is.na(Inc1)==&quot;TRUE&quot;,
                              MedianIncContinent,
                              Inc1))

#Drop Unneeded Columns
Lifeclean26 = select(Lifeclean25,-c(Income.composition.of.resources,MedianIncContinent,MedianIncCountry,Inc1))

##SanityCheck
missmap(Lifeclean26)</code></pre>
<p><img src="Life-Expectancy_files/figure-html/Impute%20other%20missing%20values-5.png" width="672" /></p>
<pre class="r"><code>##Compute Median by Country
SchoolCountry = Lifeclean26 %&gt;% 
  filter(is.na(Schooling) == &quot;FALSE&quot;) %&gt;% 
  group_by(Country) %&gt;% 
  summarize(MedianSchoolCountry = median(Schooling))

##Compute Median by Continent
SchoolContinent = Lifeclean26 %&gt;% 
  filter(is.na(Schooling) == &quot;FALSE&quot;) %&gt;% 
  group_by(Continent) %&gt;% 
  summarize(MedianSchoolContinent = median(Schooling))

#Merge Medians by Continent
Lifeclean27 &lt;- merge(x = Lifeclean26,y = SchoolContinent,by = &quot;Continent&quot;,all.x = TRUE)

#Merge Medians by Country
Lifeclean28 &lt;- merge(x = Lifeclean27,y = SchoolCountry,by = &quot;Country&quot;,all.x = TRUE)

#If statement to cascade which median to use: Non-N/A Value &gt; Country Median
Lifeclean29 = within(Lifeclean28, 
                     School1 &lt;- 
                       ifelse(is.na(Schooling)==&quot;TRUE&quot;,
                              MedianSchoolCountry,
                              Schooling))

#If statement to cascade which median to use: Non-N/A value &gt; Country Median &gt; Continent Median
## Could be more efficient, but couldn&#39;t get nested ifelse to work
Lifeclean30 = within(Lifeclean29, 
                     SchoolFinal &lt;- 
                       ifelse(is.na(School1)==&quot;TRUE&quot;,
                              MedianSchoolContinent,
                              School1))

#Drop Unneeded Columns
Lifeclean31 = select(Lifeclean30,-c(Schooling,MedianSchoolContinent,MedianSchoolCountry,School1))

##SanityCheck
missmap(Lifeclean31)</code></pre>
<p><img src="Life-Expectancy_files/figure-html/Impute%20other%20missing%20values-6.png" width="672" /></p>
<pre class="r"><code>##Compute Median by Country
Thin5Country = Lifeclean31 %&gt;% 
  filter(is.na(thinness.5.9.years) == &quot;FALSE&quot;) %&gt;% 
  group_by(Country) %&gt;% 
  summarize(MedianThin5Country = median(thinness.5.9.years))

##Compute Median by Continent
Thin5Continent = Lifeclean31 %&gt;% 
  filter(is.na(thinness.5.9.years) == &quot;FALSE&quot;) %&gt;% 
  group_by(Continent) %&gt;% 
  summarize(MedianThin5Continent = median(thinness.5.9.years))

#Merge Medians by Continent
Lifeclean32 &lt;- merge(x = Lifeclean31,y = Thin5Continent,by = &quot;Continent&quot;,all.x = TRUE)

#Merge Medians by Country
Lifeclean33 &lt;- merge(x = Lifeclean32,y = Thin5Country,by = &quot;Country&quot;,all.x = TRUE)

#If statement to cascade which median to use: Non-N/A Value &gt; Country Median
Lifeclean34 = within(Lifeclean33, 
                     Thin51 &lt;- 
                       ifelse(is.na(thinness.5.9.years)==&quot;TRUE&quot;,
                              MedianThin5Country,
                              thinness.5.9.years))

#If statement to cascade which median to use: Non-N/A value &gt; Country Median &gt; Continent Median
## Could be more efficient, but couldn&#39;t get nested ifelse to work
Lifeclean35 = within(Lifeclean34, 
                     Thin5Final &lt;- 
                       ifelse(is.na(Thin51)==&quot;TRUE&quot;,
                              MedianThin5Continent,
                              Thin51))

#Drop Unneeded Columns
Lifeclean36 = select(Lifeclean35,-c(thinness.5.9.years,MedianThin5Continent,MedianThin5Country,Thin51))

##SanityCheck
missmap(Lifeclean36)</code></pre>
<p><img src="Life-Expectancy_files/figure-html/Impute%20other%20missing%20values-7.png" width="672" /></p>
<pre class="r"><code>##Compute Median by Country
Thin10Country = Lifeclean36 %&gt;% 
  filter(is.na(thinness..1.19.years) == &quot;FALSE&quot;) %&gt;% 
  group_by(Country) %&gt;% 
  summarize(MedianThin10Country = median(thinness..1.19.years))

##Compute Median by Continent
Thin10Continent = Lifeclean36 %&gt;% 
  filter(is.na(thinness..1.19.years) == &quot;FALSE&quot;) %&gt;% 
  group_by(Continent) %&gt;% 
  summarize(MedianThin10Continent = median(thinness..1.19.years))

#Merge Medians by Continent
Lifeclean37 &lt;- merge(x = Lifeclean36,y = Thin10Continent,by = &quot;Continent&quot;,all.x = TRUE)

#Merge Medians by Country
Lifeclean38 &lt;- merge(x = Lifeclean37,y = Thin10Country,by = &quot;Country&quot;,all.x = TRUE)

#If statement to cascade which median to use: Non-N/A Value &gt; Country Median
Lifeclean39 = within(Lifeclean38, 
                     Thin101 &lt;- 
                       ifelse(is.na(thinness..1.19.years)==&quot;TRUE&quot;,
                              MedianThin10Country,
                              thinness..1.19.years))

#If statement to cascade which median to use: Non-N/A value &gt; Country Median &gt; Continent Median
## Could be more efficient, but couldn&#39;t get nested ifelse to work
Lifeclean40 = within(Lifeclean39, 
                     Thin10Final &lt;- 
                       ifelse(is.na(Thin101)==&quot;TRUE&quot;,
                              MedianThin10Continent,
                              Thin101))

#Drop Unneeded Columns
Lifeclean41 = select(Lifeclean40,-c(thinness..1.19.years,MedianThin10Continent,MedianThin10Country,Thin101))

##SanityCheck
missmap(Lifeclean41)</code></pre>
<p><img src="Life-Expectancy_files/figure-html/Impute%20other%20missing%20values-8.png" width="672" /></p>
<pre class="r"><code>##Compute Median by Country
Thin10Country = Lifeclean36 %&gt;% 
  filter(is.na(thinness..1.19.years) == &quot;FALSE&quot;) %&gt;% 
  group_by(Country) %&gt;% 
  summarize(MedianThin10Country = median(thinness..1.19.years))

##Compute Median by Continent
Thin10Continent = Lifeclean36 %&gt;% 
  filter(is.na(thinness..1.19.years) == &quot;FALSE&quot;) %&gt;% 
  group_by(Continent) %&gt;% 
  summarize(MedianThin10Continent = median(thinness..1.19.years))

#Merge Medians by Continent
Lifeclean37 &lt;- merge(x = Lifeclean36,y = Thin10Continent,by = &quot;Continent&quot;,all.x = TRUE)

#Merge Medians by Country
Lifeclean38 &lt;- merge(x = Lifeclean37,y = Thin10Country,by = &quot;Country&quot;,all.x = TRUE)

#If statement to cascade which median to use: Non-N/A Value &gt; Country Median
Lifeclean39 = within(Lifeclean38, 
                     Thin101 &lt;- 
                       ifelse(is.na(thinness..1.19.years)==&quot;TRUE&quot;,
                              MedianThin10Country,
                              thinness..1.19.years))

#If statement to cascade which median to use: Non-N/A value &gt; Country Median &gt; Continent Median
## Could be more efficient, but couldn&#39;t get nested ifelse to work
Lifeclean40 = within(Lifeclean39, 
                     Thin10Final &lt;- 
                       ifelse(is.na(Thin101)==&quot;TRUE&quot;,
                              MedianThin10Continent,
                              Thin101))

#Drop Unneeded Columns
Lifeclean41 = select(Lifeclean40,-c(thinness..1.19.years,MedianThin10Continent,MedianThin10Country,Thin101))

##SanityCheck
missmap(Lifeclean41)

##Compute Median by Country
BMICountry = Lifeclean41 %&gt;% 
  filter(is.na(BMI) == &quot;FALSE&quot;) %&gt;% 
  group_by(Country) %&gt;% 
  summarize(MedianBMICountry = median(BMI))

##Compute Median by Continent
BMIContinent = Lifeclean41 %&gt;% 
  filter(is.na(BMI) == &quot;FALSE&quot;) %&gt;% 
  group_by(Continent) %&gt;% 
  summarize(MedianBMIContinent = median(BMI))

#Merge Medians by Continent
Lifeclean42 &lt;- merge(x = Lifeclean41,y = BMIContinent,by = &quot;Continent&quot;,all.x = TRUE)

#Merge Medians by Country
Lifeclean43 &lt;- merge(x = Lifeclean42,y = BMICountry,by = &quot;Country&quot;,all.x = TRUE)

#If statement to cascade which median to use: Non-N/A Value &gt; Country Median
Lifeclean44 = within(Lifeclean43, 
                     BMI1 &lt;- 
                       ifelse(is.na(BMI)==&quot;TRUE&quot;,
                              MedianBMICountry,
                              BMI))

#If statement to cascade which median to use: Non-N/A value &gt; Country Median &gt; Continent Median
## Could be more efficient, but couldn&#39;t get nested ifelse to work
Lifeclean45 = within(Lifeclean44, 
                     BMIFinal &lt;- 
                       ifelse(is.na(BMI1)==&quot;TRUE&quot;,
                              MedianBMIContinent,
                              BMI1))

#Drop Unneeded Columns
Lifeclean46 = select(Lifeclean45,-c(BMI,MedianBMIContinent,MedianBMICountry,BMI1))

##SanityCheck
missmap(Lifeclean46)</code></pre>
<p><img src="Life-Expectancy_files/figure-html/Impute%20other%20missing%20values-9.png" width="672" /></p>
<pre class="r"><code>##Compute Median by Country
DiptheriaCountry = Lifeclean46 %&gt;% 
  filter(is.na(Diphtheria) == &quot;FALSE&quot;) %&gt;% 
  group_by(Country) %&gt;% 
  summarize(MedianDiptheriaCountry = median(Diphtheria))

##Compute Median by Continent
DiptheriaContinent = Lifeclean46 %&gt;% 
  filter(is.na(Diphtheria) == &quot;FALSE&quot;) %&gt;% 
  group_by(Continent) %&gt;% 
  summarize(MedianDiptheriaContinent = median(Diphtheria))

#Merge Medians by Continent
Lifeclean47 &lt;- merge(x = Lifeclean46,y = DiptheriaContinent,by = &quot;Continent&quot;,all.x = TRUE)

#Merge Medians by Country
Lifeclean48 &lt;- merge(x = Lifeclean47,y = DiptheriaCountry,by = &quot;Country&quot;,all.x = TRUE)

#If statement to cascade which median to use: Non-N/A Value &gt; Country Median
Lifeclean49 = within(Lifeclean48, 
                     Dip1 &lt;- 
                       ifelse(is.na(Diphtheria)==&quot;TRUE&quot;,
                              MedianDiptheriaCountry,
                              Diphtheria))

#If statement to cascade which median to use: Non-N/A value &gt; Country Median &gt; Continent Median
## Could be more efficient, but couldn&#39;t get nested ifelse to work
Lifeclean50 = within(Lifeclean49, 
                     DiptheriaFinal &lt;- 
                       ifelse(is.na(Dip1)==&quot;TRUE&quot;,
                              MedianDiptheriaContinent,
                              Dip1))

#Drop Unneeded Columns
Lifeclean51 = select(Lifeclean50,-c(Diphtheria,MedianDiptheriaContinent,MedianDiptheriaCountry,Dip1))

##SanityCheck
missmap(Lifeclean51)</code></pre>
<p><img src="Life-Expectancy_files/figure-html/Impute%20other%20missing%20values-10.png" width="672" /></p>
<pre class="r"><code>##Compute Median by Country
PolioCountry = Lifeclean51 %&gt;% 
  filter(is.na(Polio) == &quot;FALSE&quot;) %&gt;% 
  group_by(Country) %&gt;% 
  summarize(MedianPolioCountry = median(Polio))

##Compute Median by Continent
PolioContinent = Lifeclean51 %&gt;% 
  filter(is.na(Polio) == &quot;FALSE&quot;) %&gt;% 
  group_by(Continent) %&gt;% 
  summarize(MedianPolioContinent = median(Polio))

#Merge Medians by Continent
Lifeclean52 &lt;- merge(x = Lifeclean51,y = PolioContinent,by = &quot;Continent&quot;,all.x = TRUE)

#Merge Medians by Country
Lifeclean53 &lt;- merge(x = Lifeclean52,y = PolioCountry,by = &quot;Country&quot;,all.x = TRUE)

#If statement to cascade which median to use: Non-N/A Value &gt; Country Median
Lifeclean54 = within(Lifeclean53, 
                     Polio1 &lt;- 
                       ifelse(is.na(Polio)==&quot;TRUE&quot;,
                              MedianPolioCountry,
                              Polio))

#If statement to cascade which median to use: Non-N/A value &gt; Country Median &gt; Continent Median
## Could be more efficient, but couldn&#39;t get nested ifelse to work
Lifeclean55 = within(Lifeclean54, 
                     PolioFinal &lt;- 
                       ifelse(is.na(Polio1)==&quot;TRUE&quot;,
                              MedianPolioContinent,
                              Polio1))

#Drop Unneeded Columns
Lifeclean56 = select(Lifeclean55,-c(Polio,MedianPolioContinent,MedianPolioCountry,Polio1))

##SanityCheck
missmap(Lifeclean56)</code></pre>
<p><img src="Life-Expectancy_files/figure-html/Impute%20other%20missing%20values-11.png" width="672" /></p>
<pre class="r"><code>#Change Column Names back to Original
names(Lifeclean56) &lt;- c(&quot;Country&quot;,&quot;Continent&quot;,&quot;Year&quot;,&quot;Status&quot;,&quot;Life.expectancy&quot;,&quot;Adult.Mortality&quot;,&quot;infant.deaths&quot;,
                        &quot;percentage.expenditure&quot;,&quot;Measles&quot;,&quot;under.five.deaths&quot;,&quot;HIV.AIDS&quot;,&quot;Population&quot;,&quot;GDP&quot;,
                        &quot;Hepatitis.B&quot;,&quot;Total.expenditure&quot;,&quot;Alcohol&quot;,&quot;Income.composition.of.resources&quot;,
                        &quot;Schooling&quot;,&quot;thinness.5.9.years&quot;,&quot;thinness..1.19.years&quot;,&quot;BMI&quot;,&quot;Diphtheria&quot;,&quot;Polio&quot;)

#Create Final Dataset
LifeFinal = Lifeclean56

#Final Sanity Check - only N/A&#39;s relate to South Sudan&#39;s GDP (Wasn&#39;t a country prior to 2008). All set!
missmap(LifeFinal)</code></pre>
<p><img src="Life-Expectancy_files/figure-html/Impute%20other%20missing%20values-12.png" width="672" /></p>
<pre class="r"><code>LifeFinal %&gt;% filter(is.na(GDP)==&quot;TRUE&quot;)</code></pre>
<pre><code>##       Country Continent Year     Status Life.expectancy Adult.Mortality
## 1 South Sudan    Africa 2001 Developing            49.6             381
## 2 South Sudan    Africa 2007 Developing            53.1             381
## 3 South Sudan    Africa 2005 Developing            51.9             383
## 4 South Sudan    Africa 2002 Developing            52.0             382
## 5 South Sudan    Africa 2006 Developing            52.5             383
## 6 South Sudan    Africa 2000 Developing            48.9              38
## 7 South Sudan    Africa 2003 Developing            58.0             383
## 8 South Sudan    Africa 2004 Developing            51.4             383
##   infant.deaths percentage.expenditure Measles under.five.deaths HIV.AIDS
## 1            30                      0       0                49      3.0
## 2            27                      0       0                43      4.2
## 3            28                      0       0                44      3.9
## 4            30                      0       0                48      3.3
## 5            28                      0       0                43      4.1
## 6            31                      0       0                50      2.7
## 7            29                      0       0                46      3.5
## 8            29                      0       0                45      3.8
##   Population GDP Hepatitis.B Total.expenditure Alcohol
## 1    6447791  NA          31              2.74   1.505
## 2    8315144  NA          31              2.74   1.505
## 3    7535931  NA          31              2.74   1.505
## 4    6688225  NA          31              2.74   1.505
## 5    7907407  NA          31              2.74   1.505
## 6    6199396  NA          31              2.74   1.505
## 7    6935665  NA          31              2.74   1.505
## 8    7213354  NA          31              2.74   1.505
##   Income.composition.of.resources Schooling thinness.5.9.years
## 1                               0         0                7.3
## 2                               0         0                7.3
## 3                               0         0                7.3
## 4                               0         0                7.3
## 5                               0         0                7.3
## 6                               0         0                7.3
## 7                               0         0                7.3
## 8                               0         0                7.3
##   thinness..1.19.years  BMI Diphtheria Polio
## 1                  7.4 21.5         45    44
## 2                  7.4 21.5         45    44
## 3                  7.4 21.5         45    44
## 4                  7.4 21.5         45    44
## 5                  7.4 21.5         45    44
## 6                  7.4 21.5         45    44
## 7                  7.4 21.5         45    44
## 8                  7.4 21.5         45    44</code></pre>
<p>##Life Expectancy Random Forest</p>
<pre class="r"><code>#Load Libraries
library(randomForest)</code></pre>
<pre><code>## Warning: package &#39;randomForest&#39; was built under R version 4.0.2</code></pre>
<pre><code>## randomForest 4.6-14</code></pre>
<pre><code>## Type rfNews() to see new features/changes/bug fixes.</code></pre>
<pre><code>## 
## Attaching package: &#39;randomForest&#39;</code></pre>
<pre><code>## The following object is masked from &#39;package:dplyr&#39;:
## 
##     combine</code></pre>
<pre><code>## The following object is masked from &#39;package:ggplot2&#39;:
## 
##     margin</code></pre>
<pre class="r"><code>library(tree)</code></pre>
<pre><code>## Warning: package &#39;tree&#39; was built under R version 4.0.2</code></pre>
<pre><code>## Registered S3 method overwritten by &#39;tree&#39;:
##   method     from
##   print.tree cli</code></pre>
<pre class="r"><code>#Remove N/A&#39;s for modeling
LifeFinal1 = LifeFinal %&gt;% filter(is.na(GDP) == &quot;FALSE&quot;)

#Run Model
set.seed(1)
train = sample(1:nrow(LifeFinal1),nrow(LifeFinal1)/2)
life.test = LifeFinal1[-train,&quot;Life.expectancy&quot;]
rf.life = randomForest(Life.expectancy~.,data = LifeFinal1,subset=train,mtry=5,importance=TRUE)
yhat.rf=predict(rf.life,newdata = LifeFinal1[-train,])
sqrt(mean((yhat.rf-life.test)^2))</code></pre>
<pre><code>## [1] 2.040522</code></pre>
<pre class="r"><code>#see importance of variables
importance(rf.life)</code></pre>
<pre><code>##                                   %IncMSE IncNodePurity
## Country                         26.115081      826.2143
## Continent                       20.395530    10670.0828
## Year                            19.918935      748.4791
## Status                           8.578715     1182.1974
## Adult.Mortality                 32.611413    17865.0830
## infant.deaths                   14.031224     2371.9716
## percentage.expenditure          16.435598      951.3363
## Measles                         15.125166      590.9969
## under.five.deaths               14.897895     3516.4078
## HIV.AIDS                        30.723213    23707.6794
## Population                      21.571510     1262.4905
## GDP                             20.492146     2520.7922
## Hepatitis.B                     12.798823      919.7606
## Total.expenditure               26.291893     1103.4171
## Alcohol                         25.072044     1440.1135
## Income.composition.of.resources 29.873848    27478.5531
## Schooling                       20.936608    14960.3911
## thinness.5.9.years              20.607620     3143.8280
## thinness..1.19.years            21.920208     2917.9425
## BMI                             14.925183     4562.4541
## Diphtheria                      16.234734     3329.4598
## Polio                           17.155434     4239.8619</code></pre>
<pre class="r"><code>varImpPlot(rf.life,main = &#39;Variable Importance for Life Expectancy&#39;)</code></pre>
<p><img src="Life-Expectancy_files/figure-html/Create%20the%20Random%20Forest%20Model-1.png" width="672" /></p>
<pre class="r"><code>#See the Full Model
rf.life</code></pre>
<pre><code>## 
## Call:
##  randomForest(formula = Life.expectancy ~ ., data = LifeFinal1,      mtry = 5, importance = TRUE, subset = train) 
##                Type of random forest: regression
##                      Number of trees: 500
## No. of variables tried at each split: 5
## 
##           Mean of squared residuals: 3.567013
##                     % Var explained: 96.03</code></pre>




</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open')
  });
});
</script>

<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
